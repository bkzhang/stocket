<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <title>Stocket</title>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <script type="text/javascript" src="http://localhost:8446/socket.io/socket.io.js"></script>
  </head> 

  <body>
    <div id="stockChart" style="height:400px;"></div>
    <div id="quotes"></div>
  </body>

  <script type="text/javascript">
    'use strict' 

    $(document).ready(() => {
      const ticker = location.hash.substr(1)
      const socket = io.connect('http://localhost:8446')

      socket.emit('ticker', ticker)
      socket.on(ticker, (res) => {
        let data = $('<pre>' + res + '</pre><hr />')
        $('#quotes').append(data) 
        $(data).show('slide', { direction: 'down' }, 300) 
      })

      $(window).on('hashchange', () => {
        let ticker = location.hash.substr(1)
        socket.emit('ticker', ticker)
      })
    })
    
    $.getJSON('https://www.highcharts.com/samples/data/jsonp.php?filename=new-intraday.json&callback=?', function (data) {
 
    Highcharts.stockChart('container', {
      title: {
          text: 'AAPL stock price by minute'
      },

      rangeSelector: {
        buttons: [{
          type: 'hour',
          count: 1,
          text: '1h'
        }, {
          type: 'day',
          count: 1,
          text: '1D'
        }, {
          type: 'all',
          count: 1,
          text: 'All'
        }],
          selected: 1,
          inputEnabled: false
        },

        series: [{
          name: 'AAPL',
          type: 'candlestick',
          data: data,
          tooltip: {
            valueDecimals: 2
           }
        }]
      })
    })
  </script>
</html>
